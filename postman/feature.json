{
	"info": {
		"_postman_id": "e0906d06-4969-499c-a7ca-37fe920894b3",
		"name": "EWM — Комментарии к событиям",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "46926719"
	},
	"item": [
		{
			"name": "Подготовка",
			"item": [
				{
					"name": "Создать инициатора события",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 201\", () => pm.response.to.have.status(201)); \r",
									"pm.collectionVariables.set(\"initiatorId\", pm.response.json().id);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"name\": \"Инициатор\", \r\n    \"email\": \"init@test.ru\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/admin/users",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"admin",
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "Создать комментатора",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 201\", () => pm.response.to.have.status(201)); \r",
									"pm.collectionVariables.set(\"userId\", pm.response.json().id);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"name\": \"Комментатор\", \r\n    \"email\": \"user@test.ru\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/admin/users",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"admin",
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "Создание категории",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 201\", () => pm.response.to.have.status(201)); \r",
									"pm.collectionVariables.set(\"categorieId\", pm.response.json().id);"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"name\": \"комментарий\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/admin/categories",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"admin",
								"categories"
							]
						}
					},
					"response": []
				},
				{
					"name": "Создание события",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 201\", () => pm.response.to.have.status(201)); \r",
									"pm.collectionVariables.set(\"eventId\", pm.response.json().id);\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{ \r\n    \"annotation\": \"Тест комментариев к событию для создания коментария\",\r\n    \"category\": 1,\r\n    \"description\": \"Описание к событию для создания коментария\",\r\n    \"eventDate\": \"2030-01-01 15:00:00\",\r\n    \"location\": {\r\n        \"lat\": 55.75,\r\n        \"lon\": 37.61\r\n        },\r\n     \"paid\": false,\r\n     \"participantLimit\": 0,\r\n     \"requestModeration\": false,\r\n     \"title\": \"Тестовое событие\"\r\n    }\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/users/{{initiatorId}}/events",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"{{initiatorId}}",
								"events"
							]
						}
					},
					"response": []
				},
				{
					"name": "Опубликовать событие",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 200\", () => pm.response.to.have.status(200));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"stateAction\": \"PUBLISH_EVENT\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/admin/events/{{eventId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"admin",
								"events",
								"{{eventId}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "проверка комментария",
			"item": [
				{
					"name": "Добавить комментарий (успешно)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 201\", () => pm.response.to.have.status(201)); \r",
									"pm.collectionVariables.set(\"commentId\", pm.response.json().id); \r",
									"pm.expect(pm.response.json().text).to.eql(\"Отличное событие!\");"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"text\": \"Отличное событие!\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/users/{{userId}}/comments?eventId={{eventId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"{{userId}}",
								"comments"
							],
							"query": [
								{
									"key": "eventId",
									"value": "{{eventId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Добавить комментарий (успешно) 2",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 201\", () => pm.response.to.have.status(201)); \r",
									"pm.collectionVariables.set(\"commentId2\", pm.response.json().id); \r",
									"pm.expect(pm.response.json().text).to.eql(\"Второй комментарий!\");"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"text\": \"Второй комментарий!\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/users/{{userId}}/comments?eventId={{eventId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"{{userId}}",
								"comments"
							],
							"query": [
								{
									"key": "eventId",
									"value": "{{eventId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Пустой текст комментария",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 400\", () => pm.response.to.have.status(400));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"text\": \"\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/users/{{userId}}/comments?eventId={{eventId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"{{userId}}",
								"comments"
							],
							"query": [
								{
									"key": "eventId",
									"value": "{{eventId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Текст больше 2000 символов",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 400\", () => pm.response.to.have.status(400));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"text\": \"This is a sample long text string generated for testing purposes in Postman. It contains exactly 2025 characters and is designed to simulate a realistic payload that exceeds the 2000-character threshold. Such payloads are common in APIs that handle user input, comments, descriptions, logs, or document content. When testing, it's important to verify that your backend correctly processes large inputs without truncation, corruption, or performance degradation. This string includes letters, spaces, punctuation, and typical sentence structure to mimic real-world data. Please ensure your server configuration (e.g., in Spring Boot, Nginx, or Express) allows sufficiently large request bodies to avoid 413 Payload Too Large errors. Additionally, validate that your database fields (like VARCHAR or TEXT in PostgreSQL) can accommodate the full length. Always test edge cases: empty strings, maximum allowed length, and slightly over the limit. Remember to sanitize and validate all incoming data to prevent security vulnerabilities such as injection attacks or denial-of-service via extremely large payloads. Finally, confirm that your API documentation clearly states any size limitations for request bodies so that clients can comply. This sentence continues to add more characters to reach the target length of 2025. We are almost there—just a few more words needed to ensure we meet the requirement precisely. Done! This is a sample long text string generated for testing purposes in Postman. It contains exactly 2025 characters and is designed to simulate a realistic payload that exceeds the 2000-character threshold. Such payloads are common in APIs that handle user input, comments, descriptions, logs, or document content. When testing, it's important to verify that your backend correctly processes large inputs without truncation, corruption, or performance degradation. This string includes letters, spaces, punctuation, and typical sentence structure to mimic real-world data. Please ensure your server configuration (e.g., in Spring Boot, Nginx, or Express) allows sufficiently large request bodies to avoid 413 Payload Too Large errors. Additionally, validate that your database fields (like VARCHAR or TEXT in PostgreSQL) can accommodate the full length. Always test edge cases: empty strings, maximum allowed length, and slightly over the limit. Remember to sanitize and validate all incoming data to prevent security vulnerabilities such as injection attacks or denial-of-service via extremely large payloads. Finally, confirm that your API documentation clearly states any size limitations for request bodies so that clients can comply. This sentence continues to add more characters to reach the target length of 2025. We are almost there—just a few more words needed to ensure we meet the requirement precisely. Done!\"\r\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/users/{{userId}}/comments?eventId={{eventId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"{{userId}}",
								"comments"
							],
							"query": [
								{
									"key": "eventId",
									"value": "{{eventId}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Комментарий к неопубликованному",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 409\", () => pm.response.to.have.status(404));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"text\": \"Не должно пройти\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/users/{{userId}}/comments?eventId=999999",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"{{userId}}",
								"comments"
							],
							"query": [
								{
									"key": "eventId",
									"value": "999999"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Обновить свой комментарий",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 200\", () => pm.response.to.have.status(200)); \r",
									"pm.expect(pm.response.json().text).to.eql(\"Исправил комментарий\");"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"text\": \"Исправил комментарий\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/users/{{userId}}/comments/{{commentId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"{{userId}}",
								"comments",
								"{{commentId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Обновить чужой комментарий",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 409\", () => pm.response.to.have.status(409));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\r\n    \"text\": \"Чужой комментарий\"\r\n}\r\n",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "http://localhost:8080/users/999999/comments/{{commentId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"999999",
								"comments",
								"{{commentId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Удалить свой комментарий",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 204\", () => pm.response.to.have.status(204));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://localhost:8080/users/{{userId}}/comments/{{commentId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"{{userId}}",
								"comments",
								"{{commentId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Удалить чужой комментарий",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 409\", () => pm.response.to.have.status(404));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://localhost:8080/users/999999/comments/{{commentId}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"999999",
								"comments",
								"{{commentId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Получить список комментариев к событию",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 200\", () => pm.response.to.have.status(200));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://localhost:8080/events/{{eventId}}/comments?from=0&size=10",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"events",
								"{{eventId}}",
								"comments"
							],
							"query": [
								{
									"key": "from",
									"value": "0"
								},
								{
									"key": "size",
									"value": "10"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Получить свои комментарии",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 200\", () => pm.response.to.have.status(200)); \r",
									"pm.response.json().forEach(c => pm.expect(c.author.id).to.eql(Number(pm.collectionVariables.get(\"userId\"))));\r",
									""
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://localhost:8080/users/{{userId}}/comments",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"users",
								"{{userId}}",
								"comments"
							]
						}
					},
					"response": []
				},
				{
					"name": "Удалить любой комментарий",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Статус 204\", () => pm.response.to.have.status(204));"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"packages": {},
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "http://localhost:8080/admin/comments/{{commentId2}}",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8080",
							"path": [
								"admin",
								"comments",
								"{{commentId2}}"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"variable": [
		{
			"key": "initiatorId",
			"value": ""
		},
		{
			"key": "userId",
			"value": ""
		},
		{
			"key": "eventId",
			"value": ""
		},
		{
			"key": "categorieId",
			"value": ""
		},
		{
			"key": "commentId",
			"value": ""
		},
		{
			"key": "commentId2",
			"value": ""
		}
	]
}